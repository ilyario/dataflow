---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
    "helm.sh/hook": crd-install
    "helm.sh/hook-weight": "-5"
  name: dataflows.dataflow.dataflow.io
spec:
  group: dataflow.dataflow.io
  names:
    kind: DataFlow
    listKind: DataFlowList
    plural: dataflows
    singular: dataflow
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        description: DataFlow is the Schema for the dataflows API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types
            type: string
          metadata:
            type: object
          spec:
            description: DataFlowSpec defines the desired state of DataFlow
            properties:
              sink:
                description: Sink defines the destination of data
                properties:
                  iceberg:
                    description: Iceberg sink configuration
                    properties:
                      autoCreateNamespace:
                        description: |-
                          AutoCreateNamespace automatically creates the namespace if it doesn't exist
                          Defaults to true if not specified
                        type: boolean
                      autoCreateTable:
                        description: AutoCreateTable automatically creates the table
                          if it doesn't exist
                        type: boolean
                      namespace:
                        description: Namespace in the catalog
                        type: string
                      restCatalogUrl:
                        description: RESTCatalogURL is the URL of the Iceberg REST
                          Catalog
                        type: string
                      table:
                        description: Table name
                        type: string
                      token:
                        description: Authentication token
                        type: string
                    required:
                    - namespace
                    - restCatalogUrl
                    - table
                    type: object
                  kafka:
                    description: Kafka sink configuration
                    properties:
                      brokers:
                        description: Brokers is a list of Kafka broker addresses
                        items:
                          type: string
                        type: array
                      sasl:
                        description: SASL configuration
                        properties:
                          mechanism:
                            description: 'Mechanism: plain, scram-sha-256, scram-sha-512'
                            type: string
                          password:
                            description: Password
                            type: string
                          username:
                            description: Username
                            type: string
                        required:
                        - mechanism
                        - password
                        - username
                        type: object
                      tls:
                        description: TLS configuration
                        properties:
                          caFile:
                            description: CAFile path to CA certificate file
                            type: string
                          certFile:
                            description: CertFile path to certificate file
                            type: string
                          insecureSkipVerify:
                            description: InsecureSkipVerify skips certificate verification
                            type: boolean
                          keyFile:
                            description: KeyFile path to key file
                            type: string
                        type: object
                      topic:
                        description: Topic to write to
                        type: string
                    required:
                    - brokers
                    - topic
                    type: object
                  postgresql:
                    description: PostgreSQL sink configuration
                    properties:
                      autoCreateTable:
                        description: AutoCreateTable automatically creates the table
                          if it doesn't exist
                        type: boolean
                      batchSize:
                        description: BatchSize for batch inserts
                        format: int32
                        type: integer
                      connectionString:
                        description: ConnectionString for PostgreSQL database
                        type: string
                      table:
                        description: Table to write to
                        type: string
                    required:
                    - connectionString
                    - table
                    type: object
                  rabbitmq:
                    description: RabbitMQ sink configuration
                    properties:
                      exchange:
                        description: Exchange name
                        type: string
                      queue:
                        description: Queue name (optional, for direct queue publishing)
                        type: string
                      routingKey:
                        description: RoutingKey
                        type: string
                      url:
                        description: URL connection string for RabbitMQ
                        type: string
                    required:
                    - exchange
                    - routingKey
                    - url
                    type: object
                  type:
                    description: 'Type of sink: kafka, postgresql, iceberg, rabbitmq'
                    type: string
                required:
                - type
                type: object
              source:
                description: Source defines the source of data
                properties:
                  iceberg:
                    description: Iceberg source configuration
                    properties:
                      namespace:
                        description: Namespace in the catalog
                        type: string
                      restCatalogUrl:
                        description: RESTCatalogURL is the URL of the Iceberg REST
                          Catalog
                        type: string
                      table:
                        description: Table name
                        type: string
                      token:
                        description: Authentication token
                        type: string
                    required:
                    - namespace
                    - restCatalogUrl
                    - table
                    type: object
                  kafka:
                    description: Kafka source configuration
                    properties:
                      brokers:
                        description: Brokers is a list of Kafka broker addresses
                        items:
                          type: string
                        type: array
                      consumerGroup:
                        description: ConsumerGroup for Kafka consumer
                        type: string
                      sasl:
                        description: SASL configuration
                        properties:
                          mechanism:
                            description: 'Mechanism: plain, scram-sha-256, scram-sha-512'
                            type: string
                          password:
                            description: Password
                            type: string
                          username:
                            description: Username
                            type: string
                        required:
                        - mechanism
                        - password
                        - username
                        type: object
                      tls:
                        description: TLS configuration
                        properties:
                          caFile:
                            description: CAFile path to CA certificate file
                            type: string
                          certFile:
                            description: CertFile path to certificate file
                            type: string
                          insecureSkipVerify:
                            description: InsecureSkipVerify skips certificate verification
                            type: boolean
                          keyFile:
                            description: KeyFile path to key file
                            type: string
                        type: object
                      topic:
                        description: Topic to read from
                        type: string
                    required:
                    - brokers
                    - topic
                    type: object
                  postgresql:
                    description: PostgreSQL source configuration
                    properties:
                      connectionString:
                        description: ConnectionString for PostgreSQL database
                        type: string
                      pollInterval:
                        description: PollInterval in seconds for polling mode
                        format: int32
                        type: integer
                      query:
                        description: Query for custom SQL query (optional, if not
                          provided, reads from table)
                        type: string
                      table:
                        description: Table to read from
                        type: string
                    required:
                    - connectionString
                    - table
                    type: object
                  rabbitmq:
                    description: RabbitMQ source configuration
                    properties:
                      exchange:
                        description: Exchange name (optional)
                        type: string
                      queue:
                        description: Queue name to consume from
                        type: string
                      routingKey:
                        description: RoutingKey (optional)
                        type: string
                      url:
                        description: URL connection string for RabbitMQ
                        type: string
                    required:
                    - queue
                    - url
                    type: object
                  type:
                    description: 'Type of source: kafka, postgresql, iceberg, rabbitmq'
                    type: string
                required:
                - type
                type: object
              transformations:
                description: Transformations is a list of transformations to apply
                  to messages
                items:
                  description: TransformationSpec defines a transformation to apply
                  properties:
                    filter:
                      description: Filter transformation configuration
                      properties:
                        condition:
                          description: Condition is a JSONPath expression that must
                            evaluate to true
                          type: string
                      required:
                      - condition
                      type: object
                    flatten:
                      description: Flatten transformation configuration
                      properties:
                        field:
                          description: Field is the JSONPath to the array field to
                            flatten
                          type: string
                      required:
                      - field
                      type: object
                    mask:
                      description: Mask transformation configuration
                      properties:
                        fields:
                          description: Fields is a list of JSONPath expressions to
                            mask
                          items:
                            type: string
                          type: array
                        keepLength:
                          description: KeepLength keeps the original length of the
                            value
                          type: boolean
                        maskChar:
                          description: 'MaskChar is the character to use for masking
                            (default: *)'
                          type: string
                      required:
                      - fields
                      type: object
                    remove:
                      description: Remove transformation configuration
                      properties:
                        fields:
                          description: Fields is a list of JSONPath expressions to
                            remove
                          items:
                            type: string
                          type: array
                      required:
                      - fields
                      type: object
                    router:
                      description: Router transformation configuration
                      properties:
                        routes:
                          description: Routes is a list of routing rules
                          items:
                            description: RouteRule defines a routing rule
                            properties:
                              condition:
                                description: Condition is a JSONPath expression that
                                  must evaluate to true
                                type: string
                              sink:
                                description: Sink is the sink configuration for this
                                  route
                                properties:
                                  iceberg:
                                    description: Iceberg sink configuration
                                    properties:
                                      autoCreateNamespace:
                                        description: |-
                                          AutoCreateNamespace automatically creates the namespace if it doesn't exist
                                          Defaults to true if not specified
                                        type: boolean
                                      autoCreateTable:
                                        description: AutoCreateTable automatically
                                          creates the table if it doesn't exist
                                        type: boolean
                                      namespace:
                                        description: Namespace in the catalog
                                        type: string
                                      restCatalogUrl:
                                        description: RESTCatalogURL is the URL of
                                          the Iceberg REST Catalog
                                        type: string
                                      table:
                                        description: Table name
                                        type: string
                                      token:
                                        description: Authentication token
                                        type: string
                                    required:
                                    - namespace
                                    - restCatalogUrl
                                    - table
                                    type: object
                                  kafka:
                                    description: Kafka sink configuration
                                    properties:
                                      brokers:
                                        description: Brokers is a list of Kafka broker
                                          addresses
                                        items:
                                          type: string
                                        type: array
                                      sasl:
                                        description: SASL configuration
                                        properties:
                                          mechanism:
                                            description: 'Mechanism: plain, scram-sha-256,
                                              scram-sha-512'
                                            type: string
                                          password:
                                            description: Password
                                            type: string
                                          username:
                                            description: Username
                                            type: string
                                        required:
                                        - mechanism
                                        - password
                                        - username
                                        type: object
                                      tls:
                                        description: TLS configuration
                                        properties:
                                          caFile:
                                            description: CAFile path to CA certificate
                                              file
                                            type: string
                                          certFile:
                                            description: CertFile path to certificate
                                              file
                                            type: string
                                          insecureSkipVerify:
                                            description: InsecureSkipVerify skips
                                              certificate verification
                                            type: boolean
                                          keyFile:
                                            description: KeyFile path to key file
                                            type: string
                                        type: object
                                      topic:
                                        description: Topic to write to
                                        type: string
                                    required:
                                    - brokers
                                    - topic
                                    type: object
                                  postgresql:
                                    description: PostgreSQL sink configuration
                                    properties:
                                      autoCreateTable:
                                        description: AutoCreateTable automatically
                                          creates the table if it doesn't exist
                                        type: boolean
                                      batchSize:
                                        description: BatchSize for batch inserts
                                        format: int32
                                        type: integer
                                      connectionString:
                                        description: ConnectionString for PostgreSQL
                                          database
                                        type: string
                                      table:
                                        description: Table to write to
                                        type: string
                                    required:
                                    - connectionString
                                    - table
                                    type: object
                                  rabbitmq:
                                    description: RabbitMQ sink configuration
                                    properties:
                                      exchange:
                                        description: Exchange name
                                        type: string
                                      queue:
                                        description: Queue name (optional, for direct
                                          queue publishing)
                                        type: string
                                      routingKey:
                                        description: RoutingKey
                                        type: string
                                      url:
                                        description: URL connection string for RabbitMQ
                                        type: string
                                    required:
                                    - exchange
                                    - routingKey
                                    - url
                                    type: object
                                  type:
                                    description: 'Type of sink: kafka, postgresql,
                                      iceberg, rabbitmq'
                                    type: string
                                required:
                                - type
                                type: object
                            required:
                            - condition
                            - sink
                            type: object
                          type: array
                      required:
                      - routes
                      type: object
                    select:
                      description: Select transformation configuration
                      properties:
                        fields:
                          description: Fields is a list of JSONPath expressions to
                            select
                          items:
                            type: string
                          type: array
                      required:
                      - fields
                      type: object
                    timestamp:
                      description: Timestamp transformation configuration
                      properties:
                        fieldName:
                          description: 'FieldName is the name of the timestamp field
                            (default: created_at)'
                          type: string
                        format:
                          description: 'Format is the timestamp format (default: RFC3339)'
                          type: string
                      type: object
                    type:
                      description: 'Type of transformation: timestamp, flatten, filter,
                        mask, router, select, remove'
                      type: string
                  required:
                  - type
                  type: object
                type: array
            required:
            - sink
            - source
            type: object
          status:
            description: DataFlowStatus defines the observed state of DataFlow
            properties:
              errorCount:
                description: ErrorCount is the number of errors encountered
                format: int64
                type: integer
              lastProcessedTime:
                description: LastProcessedTime is the timestamp of the last processed
                  message
                format: date-time
                type: string
              message:
                description: Message provides additional information about the status
                type: string
              phase:
                description: Phase represents the current phase of the data flow
                type: string
              processedCount:
                description: ProcessedCount is the number of processed messages
                format: int64
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

