apiVersion: dataflow.dataflow.io/v1
kind: DataFlow
metadata:
  name: kafka-avro-to-nessie
spec:
  source:
    type: kafka
    kafka:
      brokers:
        - localhost:9092
      topic: stock-topic
      consumerGroup: dataflow-nessie-group
      format: avro
      avroSchema: |
        {
          "type": "record",
          "name": "Stock",
          "namespace": "com.example",
          "fields": [
            {"name": "id", "type": "long"},
            {"name": "symbol", "type": "string"},
            {"name": "price", "type": "double"},
            {"name": "quantity", "type": "int"}
          ]
        }
  sink:
    type: nessie
    nessie:
      nessieUrl: "http://localhost:19120/api/v2"
      branch: "main"
      namespace: analytics
      table: stock_items
      autoCreateTable: true
  transformations:
    - type: timestamp
      timestamp:
        fieldName: created_at
